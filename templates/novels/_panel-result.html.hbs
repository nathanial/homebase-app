{{#if hasImage}}
<img src="{{imageUrl}}" alt="Panel {{panelIndex}}" class="panel-image">
<div class="panel-overlay">
  <button class="btn btn-small btn-secondary regenerate-btn"
          onclick="this.closest('.panel').querySelector('.panel-prompt-form').style.display = 'block'; this.closest('.panel-overlay').style.display = 'none';">
    Regenerate
  </button>
</div>
<div class="panel-caption-container">
  <input type="text" value="{{caption}}"
         hx-put="/novels/{{novelId}}/page/{{pageNumber}}/panel/{{panelIndex}}/caption"
         hx-trigger="blur, keyup[key=='Enter']"
         hx-swap="none"
         name="caption"
         placeholder="Add caption..."
         class="panel-caption-input">
</div>
<form class="panel-prompt-form" style="display: none;"
      hx-post="/novels/{{novelId}}/page/{{pageNumber}}/panel/{{panelIndex}}/generate"
      hx-target="#panel-{{panelIndex}}"
      hx-swap="innerHTML">
  <textarea name="prompt" placeholder="Describe this panel..." class="panel-prompt-input">{{prompt}}</textarea>
  <div class="panel-prompt-actions">
    <button type="button" class="btn btn-small btn-secondary"
            onclick="this.closest('.panel-prompt-form').style.display = 'none'; this.closest('.panel').querySelector('.panel-overlay').style.display = 'flex';">
      Cancel
    </button>
    <button type="submit" class="btn btn-small btn-primary">Generate</button>
  </div>
</form>
{{else if isGenerating}}
<div class="panel-generating"
     hx-get="/novels/{{novelId}}/page/{{pageNumber}}/panel/{{panelIndex}}/status"
     hx-trigger="every 3s"
     hx-swap="outerHTML">
  <div class="spinner"></div>
  <span>Generating...</span>
</div>
{{else if isError}}
<div class="panel-error">
  <span class="error-icon">!</span>
  <p>Generation failed</p>
  <form hx-post="/novels/{{novelId}}/page/{{pageNumber}}/panel/{{panelIndex}}/generate"
        hx-target="#panel-{{panelIndex}}"
        hx-swap="innerHTML"
        class="panel-prompt-form">
    <textarea name="prompt" placeholder="Describe this panel..." class="panel-prompt-input">{{prompt}}</textarea>
    <button type="submit" class="btn btn-small btn-primary">Retry</button>
  </form>
</div>
{{else}}
<div class="panel-empty">
  <form hx-post="/novels/{{novelId}}/page/{{pageNumber}}/panel/{{panelIndex}}/generate"
        hx-target="#panel-{{panelIndex}}"
        hx-swap="innerHTML"
        class="panel-prompt-form">
    <textarea name="prompt" placeholder="Describe this panel..." class="panel-prompt-input"></textarea>
    <button type="submit" class="btn btn-small btn-primary">Generate</button>
  </form>
</div>
{{/if}}
